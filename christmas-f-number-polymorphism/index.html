
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Christmas F# Polymorphism - Deliberate Software</title>
  <meta name="author" content="Steve Shogren">

  
  <meta name="description" content="One of my favorite things about F# is how it lets you choose how you want
to align your data. In the previous posts highlighting on
pattern matching &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://deliberate-software.com/christmas-f-number-polymorphism/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Deliberate Software" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script src="/javascripts/libs/angular.js"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46040901-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Deliberate Software</a></h1>
  
    <h2>With deliberate practice come consistent results</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="deliberate-software.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">All Posts</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Christmas F# Polymorphism</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-06T13:37:00-05:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:37 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>One of my favorite things about F# is how it lets you choose how you want
to align your data.</p>

<p>In the previous posts highlighting on
<a href="http://deliberate-software.com/function-pattern-matching/">pattern matching</a>
and
<a href="http://deliberate-software.com/inversed-polymorphism/">inverted polymorphism</a>
we covered how pattern matching in F# is safer than <code>if</code>
statements and can replace classes and interfaces for polymorphism. If
you are unfamiliar with these concepts, you might want to skim those
first.</p>

<p>Today, for the 6th day of the
<a href="https://sergeytihon.wordpress.com/2014/11/24/f-advent-calendar-in-english-2014/">F# Advent Calendar</a>
I wanted to highlight F#&rsquo;s flexibility in solving the
&ldquo;<a href="http://c2.com/cgi/wiki?ExpressionProblem">expression problem</a>&rdquo;.</p>

<p>Let&rsquo;s show the two alternatives, first here is one with interfaces:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="nc">IChristmasTrees</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">abstract</span> <span class="k">member</span> <span class="n">Cost</span> <span class="o">:</span> <span class="n">int</span> <span class="o">-&gt;</span> <span class="n">int</span>
</span><span class='line'>    <span class="k">abstract</span> <span class="k">member</span> <span class="n">Colors</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">-&gt;</span> <span class="kt">string</span> <span class="kt">list</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">PlasticTree</span><span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">interface</span> <span class="n">IChristmasTrees</span> <span class="k">with</span>
</span><span class='line'>        <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">Cost</span><span class="o">(</span><span class="n">jolly_factor</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">jolly_factor</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>        <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">Colors</span><span class="bp">()</span> <span class="o">=</span> <span class="o">[</span><span class="s">&quot;green&quot;</span><span class="o">;</span><span class="s">&quot;silver&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">LiveTree</span><span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="nv">HEAD_ACHE</span> <span class="o">=</span> <span class="mi">15</span>
</span><span class='line'>    <span class="k">interface</span> <span class="n">IChristmasTrees</span> <span class="k">with</span>
</span><span class='line'>        <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">Cost</span><span class="o">(</span><span class="n">jolly_factor</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">jolly_factor</span> <span class="o">+</span> <span class="mi">10</span><span class="o">)</span> <span class="o">*</span> <span class="n">HEAD_ACHE</span>
</span><span class='line'>        <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">Colors</span><span class="bp">()</span> <span class="o">=</span> <span class="o">[</span><span class="s">&quot;green&quot;</span><span class="o">;</span><span class="s">&quot;brown&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now the same functionality using pattern matching and discriminated unions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="nc">IChristmasTrees2</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">|</span> <span class="n">PlasticTree</span>
</span><span class='line'>  <span class="o">|</span> <span class="n">LiveTree</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="nv">colors</span> <span class="o">=</span> <span class="k">function</span>
</span><span class='line'>  <span class="o">|</span> <span class="n">PlasticTree</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="s">&quot;green&quot;</span><span class="o">;</span><span class="s">&quot;silver&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="o">|</span> <span class="n">LiveTree</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="s">&quot;green&quot;</span><span class="o">;</span><span class="s">&quot;brown&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="nv">cost</span> <span class="n">tree</span> <span class="n">jolly_factor</span> <span class="o">=</span>
</span><span class='line'>  <span class="k">match</span> <span class="n">tree</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="n">PlasticTree</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">jolly_factor</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>    <span class="o">|</span> <span class="n">LiveTree</span> <span class="o">-&gt;</span>
</span><span class='line'>      <span class="k">let</span> <span class="nv">HEAD_ACHE</span> <span class="o">=</span> <span class="mi">15</span>
</span><span class='line'>      <span class="o">(</span><span class="n">jolly_factor</span> <span class="o">+</span> <span class="mi">10</span><span class="o">)</span> <span class="o">*</span> <span class="n">HEAD_ACHE</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>What changes if we want to add a new type of tree? In the class-based
example, adding a new type is quite simple, you only need to edit one
place to find all the definitions regarding the new type.</p>

<p><img class="center" src="/images/new-interfaces.png" title="image" alt="images"></p>

<p>In the pattern matching example, adding a new type requires editing
every single place you created a function that matches on the
type.</p>

<p><img class="center" src="/images/new-pattern-matching.png" title="image" alt="images"></p>

<p>Thankfully, in both cases the compiler gives warnings about missing
functions or matches, so both are equally &ldquo;safe&rdquo;.</p>

<p>What about changing an existing function or adding a new function? We
now see the opposite behavior. Classes become harder to edit, because
the functions are spread across multiple classes.</p>

<p><img class="center" src="/images/change-interfaces.png" title="image" alt="images"></p>

<p>A pattern matching system is now the easier to modify, each function
only lives in one place.</p>

<p><img class="center" src="/images/change-pattern-matching.png" title="image" alt="images"></p>

<p>And that is the expression problem! The best thing about F# is that
you get to pick which one is better for each type of data! If you know
a certain type will need new behavior often, but rarely need new
types, use pattern matching. If you know there is a static set of
functions for a set of types, but the type list changes often, maybe
the traditional interfaces and classes makes the most sense.</p>

<p>There is no reason not to mix and match the two ways to handle
polymorphism, so you are free to choose the best representation for
each type of data you have!</p>

<p>Happy F#-filled Festivities!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Steve Shogren</span></span>

      




<time class='entry-date' datetime='2014-12-06T13:37:00-05:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:37 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/technical-skills/'>technical skills</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://deliberate-software.com/christmas-f-number-polymorphism/" data-via="" data-counturl="http://deliberate-software.com/christmas-f-number-polymorphism/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/emacs-project-tip/" title="Previous Post: Emacs Project Tip">&laquo; Emacs Project Tip</a>
      
      
        <a class="basic-alignment right" href="/unusual-reasons-why-clojure-is-a-delight/" title="Next Post: Six Unusual Reasons Why Clojure Is a Delight">Six Unusual Reasons Why Clojure Is a Delight &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
<section class="about-me">
  <h1>Steve Shogren</h1>
  <div class="about-text">
    <p>
      Insights gathered while learning to deliberately craft software.
    </p>
  </div>
  <span class="gravatar">
    <img src="http://www.gravatar.com/avatar/772ab2a207cb180ed699d22959b72dd9" alt="Gravatar of Steve Shogren " title="Gravatar of Steve Shogren" />
  </span>
</section>

<section>
  <h1>Top Posts</h1>
  <ul id="recent_posts">
    <li class="post">
      <a href="/ego-driven-development/">Ego Driven Development</a>
    </li>
    <li class="post">
      <a href="/programming-language-safety-algorithm/">Language Safety Score</a>
    </li>

    <li class="post">
      <a href="/intro-to-macros/">Intro To Macros</a>
    </li>
    <li class="post">
      <a href="/function-pattern-matching/">Pattern Matching - Make the Compiler Work for You</a>
    </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/teaching-clojure/">Conj 2015 - Teaching Clojure</a>
      </li>
    
      <li class="post">
        <a href="/on-defeat/">Interview Humiliation</a>
      </li>
    
      <li class="post">
        <a href="/f-number-unit-testing/">F# Unit Testing With SimpleMock</a>
      </li>
    
      <li class="post">
        <a href="/simplemock-unit-test-mocking/">SimpleMock: Language Agnostic Unit Test Mocking</a>
      </li>
    
      <li class="post">
        <a href="/safety-rank-part-2/">Language Safety Score Mark 2</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="recent_posts">
    
    
    <li class="post">
      <a href="/blog/categories/technical-skills/"><span>technical skills</span><span style="float:right">20</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/meta-game/"><span>meta game</span><span style="float:right">25</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/unit-testing/"><span>unit testing</span><span style="float:right">1</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/lisp/"><span>lisp</span><span style="float:right">3</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/clojure/"><span>clojure</span><span style="float:right">2</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/f-number/"><span>f#</span><span style="float:right">2</span></a>
    </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Steve Shogren -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<script src="/javascripts/sliders.js" type="text/javascript"></script>
<script src="/javascripts/sliders2.js" type="text/javascript"></script>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
