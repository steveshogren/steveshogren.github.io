<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Hot Loading Angular2 With State  &middot; Deliberate Software</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">


<meta property="og:title" content="Hot Loading Angular2 With State  &middot; Deliberate Software ">
<meta property="og:site_name" content="Deliberate Software"/>
<meta property="og:url" content="http://deliberate-software.com/figwheel-angular2/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2016-04-13T00:00:00Z" />
<meta property="og:article:modified_time" content="2016-04-13T00:00:00Z" />

  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@steveshogren" />
<meta name="twitter:creator" content="@steveshogren" />
<meta name="twitter:title" content="Hot Loading Angular2 With State" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="http://deliberate-software.com/figwheel-angular2/" />
<meta name="twitter:domain" content="http://deliberate-software.com/">
  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Hot Loading Angular2 With State",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2016-04-13",
    "description": "",
    "wordCount":  325 
  }
</script>



<link rel="canonical" href="http://deliberate-software.com/figwheel-angular2/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://deliberate-software.com/touch-icon-144-precomposed.png">
<link href="http://deliberate-software.com/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.15" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->


    <link rel="stylesheet" href="http://deliberate-software.com/css/fontimport.css">




    <link rel="stylesheet" href="http://deliberate-software.com/css/theme/yeti.css">


<link rel="stylesheet" href="http://deliberate-software.com/css/font-awesome.min.css">
<link rel="stylesheet" href="http://deliberate-software.com/css/style.css">
<link rel="stylesheet" href="http://deliberate-software.com/css/github-calendar.css">


  <link rel="stylesheet" href="http://deliberate-software.com/css/highlight/default.css">


</head>
<body class="map[name:yeti]">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header ">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://deliberate-software.com/">Deliberate Software</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
            <li><a href="https://www.github.com/steveshogren"><span class="fa fa-github-square"></span> GitHub</a></li>
            <li><a href="/index.xml" rel="alternate" type="application/rss+xml"> <span class="fa fa-rss-square"></span> RSS</a></li>
          
          <li>
            <a href="http://deliberate-software.com/page/books"
             title="Show list of my favorite books">
            
            Favorite Books
            </a>
          </li>
          
          <li>
            <a href="http://deliberate-software.com/page/philosophy"
             title="About me">
            
            About Me
            </a>
          </li>
          
          <li>
            <a href="http://deliberate-software.com/page/post"
             title="Show list of posts">
            
            All Posts
            </a>
          </li>
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
            
<div class="text-center">
  <h1 class="centereded">HOT LOADING ANGULAR2 WITH STATE
</h1>


  <a href="https://twitter.com/share" class="twitter-share-button" data-via="steveshogren" data-size="large">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<div class="metas col-md-12">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2016-04-13">13 Apr, 2016</time>
</small>


  <small>
  &middot; Read in about 2 min
  &middot; (325 Words)
</small>



<div class="margin-12">
  <i class="fa fa-tags"></i>
  
  <a href="http://deliberate-software.com/categories/technical-skills" class="label label-default">technical skills</a>
  
  <a href="http://deliberate-software.com/categories/clojure" class="label label-default">clojure</a>
  
  <a href="http://deliberate-software.com/categories/clojurescript" class="label label-default">clojurescript</a>
  
  <a href="http://deliberate-software.com/categories/angular" class="label label-default">angular</a>
  

 </div>
<br>
</div>

</div>

            <div class="">
    
  <div class="content">
    <p>In <a href="/cljs-angular2/">&ldquo;Using Angular2 in Clojurescript&rdquo;</a>
I showed how to get ClojureScript to run an Angular2 template. Basic hotswapping
worked, but state was lost on each load. Tweaking the original demo allows for
figwheel to swap in the template without losing client state.</p>

<p>Here is a demo of hotswapping with state preservation:</p>

<p><img src="/images/hotswap.gif"></img></p>

<p>In this demo, we add three things to a list, then change the template that draws
the list. The client state stays in the browser, while the template changes
around it! Amazing!</p>

<p>To get this working, follow the steps in the
<a href="/cljs-angular2/">&ldquo;Using Angular2 in Clojurescript&rdquo;</a> first post.</p>

<p>Replace the env/dev/cljs/dev.cljs contents with this simpler reloader:</p>

<pre><code class="language-clojure">(defn mount-component []
  ((.. js/ng -platform -browser -bootstrap)
   (.-AppComponent (.-app js/window))))

(figwheel/watch-and-reload :websocket-url &quot;ws://localhost:3449/figwheel-ws&quot;
                           :on-jsload mount-component)

(defonce only-attach-listener-once
  (.addEventListener js/document &quot;DOMContentLoaded&quot; mount-component))
</code></pre>

<p>We now only re-mount the component on figwheel notification. The state is moved
to an atom in the core namespace like so:</p>

<pre><code class="language-clojure">(defn get-app []
   (or (.-app js/window)
       (set! (.-app js/window) #js {})))

;; keep state of the component in a defonce atom
(defonce heroes (atom []))

(let [app (get-app)
      c (.Component (.-core js/ng)
                    #js {:selector &quot;my-app&quot;
                         :template (html [:div
                                          [:h1 &quot; Demo&quot;]
                                          [:div [:h2 &quot;Hero List:&quot;]]
                                          &quot;
&lt;input #newHero (keyup.enter)=\&quot;addHero(newHero.value); newHero.value='' \&quot; &gt;
&lt;button (click)=\&quot;addHero(newHero.value); newHero.value='' \&quot;&gt;Add&lt;/button&gt;
&lt;ul&gt;&lt;li *ngFor=\&quot;#hero of heroes()\&quot;&gt;{{hero}}&lt;/li&gt;&lt;/ul&gt;
&quot;
                                          ])})
      c (.Class c #js {:constructor (fn [])
                       :addHero (fn [hero]
                                  (swap! heroes #(conj % hero)))
                       :heroes (fn [] @heroes)
                       })]
  (set! (.-AppComponent app) c))
</code></pre>

<p>The site now will recompile and reload while preserving the state of the
component. This pattern can be extended to allow certain state to be preserved
while other state is reloaded. In this demo, the state in the <code>#newHero</code>
field is not preserved, while the <code>heroes</code> list is.</p>

<p>I don&rsquo;t have a great story for using hiccups to generate the special angular
tags like <code>*ngFor</code>, <code>(click)</code>, or <code>(keyup.enter)</code>. For this demo, I
left that html as just a raw string.</p>

<p>Check out the full working example on GitHub <a href="https://github.com/steveshogren/angular2-cljs/tree/5025e2983ab054c88717c89528b85c7f9aaea851">here</a></p>

  </div>
</div>


            <footer>
  <div class="centereded">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="steveshogren" data-size="large">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="http://deliberate-software.com/cljs-angular2/" title="Using Angular2 in ClojureScript">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="http://deliberate-software.com/haskell-state/" title="Wrangling State In Haskell">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <h3 class="serif col-sm-12" id="name">STEVE SHOGREN</h3>



<span class="col-xs-12 col-sm-12 col-md-12">
<a href="https://twitter.com/steveshogren" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @steveshogren</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</span>
<span class="col-xs-12 col-sm-12">
    software developer, manager, author, speaker
</span>
<h3 class="col-xs-12 col-sm-12" id="name"></h3>


<a class="col-xs-6 col-sm-4 col-md-6" href="https://leanpub.com/convincingcoworkers">
    <img class="book" src="/images/convincingcoworkerscover.jpg"></img>
</a>

<span class="col-xs-3 col-sm-4 col-md-3"></span>
<span class="col-xs-3 col-sm-4 col-md-3"></span>
















<h3 class="serif col-xs-12 col-sm-12" id="name">POSTS FOR:</h3>
<div class="col-xs-12 col-sm-12">
    <ul class="sidebar_ul">
        <li class="sidebar_li"><a href="/page/focused">New Developers</a></li>
        <li class="sidebar_li"><a href="/page/focused">Seasoned Developers</a></li>
        <li class="sidebar_li"><a href="/page/focused">Managers</a></li>
        <li class="sidebar_li"><a href="/page/post">See All Posts</a></li>
    </ul>
</div>
<h3 class="serif col-xs-12 col-sm-12" id="name">CATEGORIES</h3>
<div class="col-xs-12 col-sm-12">
    <ul class="sidebar_ul">
        
        <li class="sidebar_li">
            <a href="/categories/angular">angular</a> <span class="badge">2</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/architecture">architecture</a> <span class="badge">4</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/clojure">clojure</a> <span class="badge">11</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/clojurescript">clojurescript</a> <span class="badge">2</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/csharp">csharp</a> <span class="badge">5</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/emacs">emacs</a> <span class="badge">3</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/fsharp">fsharp</a> <span class="badge">7</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/haskell">haskell</a> <span class="badge">3</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/interviews">interviews</a> <span class="badge">2</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/management">management</a> <span class="badge">9</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/meta-game">meta-game</a> <span class="badge">25</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/refactoring">refactoring</a> <span class="badge">1</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/technical-skills">technical-skills</a> <span class="badge">29</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/unit-testing">unit-testing</a> <span class="badge">8</span>
        </li>
        
        <li class="sidebar_li">
            <a href="/categories/vim">vim</a> <span class="badge">2</span>
        </li>
        
    </ul>
</div>

        </div>
    </div>
</div>
      <footer class="footer">
    <div class="container hidden-print">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    

    


          </small>
        </div>
     </div>
    </div>
</footer>

    <script src="http://deliberate-software.com/js/jquery.min-2.1.4.js"></script>
<script src="http://deliberate-software.com/js/bootstrap.min-3.3.5.js"></script>
<script src="http://deliberate-software.com/js/github-calendar.js"></script>




<script src="http://deliberate-software.com/js/highlight.pack.js"></script>
<script src="http://deliberate-software.com/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
if (document.location.hostname.search("deliberate-software.com") !== -1) {
  var _gaq=[['_setAccount','UA-46040901-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
}
</script>


<script>
    GitHubCalendar(".calendar", "steveshogren", {global_stats:false});
</script>

  </body>
</html>

