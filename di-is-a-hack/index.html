
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Good Design, Java, or Unit Testing. Pick two. - Deliberate Software</title>
  <meta name="author" content="Steve Shogren">

  
  <meta name="description" content="Every codebase I have seen or heard of that uses dependency injection
for all dependencies also performs strict unit testing. Why is that?
What about &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />

  
  <link rel="canonical" href="http://steveshogren.github.io/di-is-a-hack">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Deliberate Software" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46040901-1', 'deliberate-software.com');
  ga('send', 'pageview');
</script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Deliberate Software</a></h1>
  
    <h2>With deliberate practice come consistent results</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:steveshogren.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/categories/technical-skills/">Technical Skills</a></li>
  <li><a href="/blog/categories/meta-game/">Meta Game</a></li>
  <li><a href="/blog/archives">All</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Good Design, Java, or Unit Testing. Pick Two.</h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


<div class="entry-content"><p>Every codebase I have seen or heard of that uses dependency injection
for all dependencies also performs strict unit testing. Why is that?
What about unit testing and DI are so linked?</p>

<p>You cannot have unit testing in Java/C# without dependency injection.</p>

<p>If you have ever seen a codebase in Java/C# that has ten injected
classes, right there, you have a codebase that does heavy unit
testing. If you are deep into the unit testing culture, you will have
been taught that it is a good design to use DI everywhere. Is it
really? Do the contortions required to do DI make your code easier to
use/reuse/refactor? Or do you do it because you have to? Can you think
of a single time where DI made anything easier?</p>

<p>The TDD proponents realized that you cannot reasonably perform unit
testing without DI in Java/C#, and so they have argued that a
completely dependency injected codebase is a good design. In reality,
DI for unit testing is a hack because Java/C# are so ill-suited to
unit testing.</p>

<p>For example, how would we unit test a function that talks to the
database in C# without a framework that requires mappings and global
singletons? We would put an interface around the database connection,
then pass it into the constructor through an optional parameter. Our
test would then make another implementor of that interface, and pass
it in when testing. This is par for the course in Java as well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">// DBConnection.cs</span>
</span><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IDBConnection</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">DBConnection</span> <span class="p">:</span> <span class="n">IDBConnection</span><span class="p">{</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// RepositoryFactory.cs</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Helpers</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Repositories</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">class</span> <span class="nc">RepositoryFactory</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">IDBConnection</span> <span class="n">con</span><span class="p">;</span>
</span><span class='line'>      <span class="k">public</span> <span class="nf">RepositoryFactory</span><span class="p">(</span><span class="n">IDBConnection</span> <span class="n">con</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="n">con</span> <span class="p">=</span> <span class="n">con</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="nf">RepositoryFactory</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="k">new</span> <span class="n">DBConnection</span><span class="p">())</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="kt">string</span> <span class="n">sql</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">con</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Tests grow in maintenance difficulty with the size of the function
being tested. Often this leads to a design with many small
one-function classes. This is actually not a bad thing! Rather than
having a single reason to change, these classes have a single reason
to &ldquo;test&rdquo;. Usually, such a design will have several classes in a row
that each only calls the next. This &ldquo;chain&rdquo; of classes together are
cohesive, but instead of being a single class together, they are all
split apart. Such a functional design would normally be fine, except
every function needs a twenty line wrapper of namespaces, imports,
interfaces, and constructors.</p>

<p>Comparatively, in languages like Javascript, Ruby, and Clojure,
replacing a function for testing is easy! Every function does not need
a twenty-line wrapper, instead we simply replace the function we want
to &ldquo;inject&rdquo; with a new function. Here is an example in Javascript:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Insert</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span> <span class="p">{</span> <span class="nx">getConnection</span><span class="p">().</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">sql</span><span class="p">);}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">getConnection</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">DatabaseConnection</span><span class="p">();</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// &quot;Mock&quot; the getConnection function in a unit test</span>
</span><span class='line'><span class="nx">getConnection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span> <span class="nx">Execute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span> <span class="p">{}}};</span>
</span></code></pre></td></tr></table></div></figure>


<p>I am now able to test my &ldquo;Insert&rdquo; function without it calling the real
dependencies. My design can take whatever shape best fits the problem,
without constraining itself to &ldquo;what works for testing&rdquo;.</p>
</div>


  <footer>
    <p class="meta">
      








  


<time datetime="2014-05-06T12:05:00-04:00" pubdate data-updated="true">May 6<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/unit-testing/'>Unit Testing</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://steveshogren.github.io/di-is-a-hack/" data-via="" data-counturl="http://steveshogren.github.io/di-is-a-hack/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/inversed-polymorphism/" title="Previous Post: Inverted Polymorphism with Pattern Matching">&laquo; Inverted Polymorphism with Pattern Matching</a>
      
      
        <a class="basic-alignment right" href="/known-issue-storage/" title="Next Post: Where to Store Known Issues">Where to Store Known Issues &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
<section class="about-me">
  <h1>Steve Shogren</h1>
  <div class="about-text">
    <p>
      Insights gathered while learning to deliberately craft software.
    </p>
  </div>
  <span class="gravatar">
    <img src="http://www.gravatar.com/avatar/772ab2a207cb180ed699d22959b72dd9" alt="Gravatar of Steve Shogren " title="Gravatar of Steve Shogren" />
  </span>
</section>

<section>
  <h1>Top Posts</h1>
  <ul id="recent_posts">
    <li class="post">
      <a href="/ego-driven-development/">Ego Driven Development</a>
    </li>
    <li class="post">
      <a href="/new-job-todo-list/">How to Suck Less at Your New Job</a>
    </li>
    <li class="post">
      <a href="/intro-to-macros/">Intro To Macros</a>
    </li>
    <li class="post">
      <a href="/function-pattern-matching/">Pattern Matching - Make the Compiler Work for You</a>
    </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/next-book/">What Book Should I Read Next?</a>
      </li>
    
      <li class="post">
        <a href="/known-issue-storage/">Where to Store Known Issues</a>
      </li>
    
      <li class="post">
        <a href="/di-is-a-hack/">Good Design, Java, or Unit Testing. Pick Two.</a>
      </li>
    
      <li class="post">
        <a href="/inversed-polymorphism/">Inverted Polymorphism With Pattern Matching</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="recent_posts">
    
    
    <li class="post">
      <a href="/blog/categories/technical-skills/"><span>Technical Skills</span><span style="float:right">15</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/meta-game/"><span>Meta Game</span><span style="float:right">17</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/unit-testing/"><span>Unit Testing</span><span style="float:right">3</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/lisp/"><span>Lisp</span><span style="float:right">4</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/clojure/"><span>Clojure</span><span style="float:right">2</span></a>
    </li>
    
    
    <li class="post">
      <a href="/blog/categories/f-number/"><span>F#</span><span style="float:right">2</span></a>
    </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Steve Shogren -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
